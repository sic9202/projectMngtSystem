<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="egovframework.projectMngt.service.impl.ProjectMngtMapper">
	<select id="getProjectList" resultType="ProjectVO">
		SELECT
			p.idx AS project_idx,
			project_name,
			project_type,
			project_reg_date,
			p.reg_user_idx,
			u.user_name AS reg_user_name
		FROM
			project p
		JOIN user u ON p.reg_user_idx = u.idx;
	</select>

	<select id="getProjectListCnt" resultType="int">
		SELECT
			COUNT(*)
		FROM
			project p
		JOIN user u ON p.reg_user_idx = u.idx;
	</select>
	
	<insert id="addProject" parameterType="ProjectVO">
		INSERT INTO 
			project (project_name, project_type, reg_user_idx) 
		VALUES 
			(#{project_name}, #{project_type}, #{reg_user_idx});
	</insert>
	
	<select id="getScheduleList" resultType="ScheduleVO" parameterType="int">
		SELECT
			s.idx AS schedule_idx,
			project_idx,
			schedule_name,
			schedule_reg_date,
			s.reg_user_idx,
			u.user_name AS reg_user_name
		FROM
			schedule s
		JOIN
			user u ON s.reg_user_idx = u.idx
		WHERE
			s.project_idx = #{project_idx};
	</select>

	<select id="getScheduleListCnt" resultType="int" parameterType="int">
		SELECT
			COUNT(*)
		FROM
			schedule s
		JOIN
			user u ON s.reg_user_idx = u.idx
		WHERE
			s.project_idx = #{project_idx};
	</select>
	
	<insert id="addSchedule" parameterType="ScheduleVO">
		INSERT INTO 
			schedule (project_idx, schedule_name, reg_user_idx) 
		VALUES 
			(#{project_idx}, #{schedule_name}, #{reg_user_idx});
	</insert>
	
	<select id="getWorkList" resultType="WorkVO" parameterType="Map">
		SELECT
			w.idx AS work_idx,
			schedule_idx,
			project_idx,
			work_info,
			work_reg_date,
			work_name,
			w.reg_user_idx,
			u.user_name AS reg_user_name
		FROM
			work w
		JOIN 
			user u ON w.reg_user_idx = u.idx
		WHERE
			w.schedule_idx = #{schedule_idx};
	</select>

	<select id="getWorkListCnt" resultType="int" parameterType="Map">
		SELECT
			COUNT(*)
		FROM
			work w
		JOIN 
			user u ON w.reg_user_idx = u.idx
		WHERE
			w.schedule_idx = #{schedule_idx};
	</select>
	
	<select id="getProjectInfo" resultType="ProjectVO" parameterType="int">
		SELECT
			p.idx AS project_idx,
			project_name,
			project_type,
			project_reg_date,
			reg_user_idx,
			u.user_name AS reg_user_name
		FROM
			project p
		JOIN 
			user u ON p.reg_user_idx = u.idx
		WHERE
			p.idx = #{project_idx};
	</select>
	
	<select id="getScheduleInfo" resultType="ScheduleVO" parameterType="int">
		SELECT
			s.idx AS schedule_idx,
			schedule_name,
			schedule_reg_date,
			s.project_idx,
			s.reg_user_idx,
			u.user_name AS reg_user_name,
			project_name
		FROM
			schedule s
		JOIN 
			user u ON s.reg_user_idx = u.idx
		JOIN
			project p ON s.project_idx = p.idx
		WHERE
			s.idx = #{schedule_idx};
	</select>
	
	<select id="getWorkInfo" resultType="WorkVo" parameterType="int">
		SELECT
			w.idx AS work_idx,
			schedule_idx,
			project_idx,
			work_info,
			work_reg_date,
			work_name,
			reg_user_idx,
			u.user_name AS reg_user_name
		FROM
			work w
		JOIN 
			user u ON w.reg_user_idx = u.idx
		WHERE
			w.idx = #{work_idx};
	</select>
	
	<select id="checkUser1" resultType="int" parameterType="Map">
		SELECT
			COUNT(*) 
		FROM 
			user
		WHERE
			user_email = #{user_id};
	</select>
	
	<select id="checkUser2" resultType="int" parameterType="Map">
		SELECT
			COUNT(*)
		FROM
			user
		WHERE
			user_email = #{user_id} AND passwd = #{encrypt_pwd};
	</select>
	
	<select id="getUserInfo" resultType="LoginVO" parameterType="Map">
		SELECT 
			idx AS user_idx,
			user_email AS user_id,
			passwd AS user_pwd,
			user_name,
			phone_num,
			join_date,
			use_yn,
			user_desc
		FROM
			user
		WHERE
			user_email = #{user_id} 
		AND
			passwd = #{encrypt_pwd};
	</select>
	
	<select id="duplicateCheck" resultType="int" parameterType="String">
		SELECT 
			COUNT(*)
		FROM
			user
		WHERE
			user_email = #{user_id} 
	</select>
	
	<select id="getWorkDataList" resultType="WorkDataVO" parameterType="int">
		SELECT
			wd.idx AS work_data_idx,
			work_idx,
			str_date,
			end_date,
			support_time,
			support_type,
			support_content,
			severity,
			reg_user_idx,
			u.user_name AS reg_user_name
		FROM
			work_data wd
		JOIN 
			user u ON wd.reg_user_idx = u.idx
		WHERE
			wd.work_idx = #{work_idx};
	</select>
	
	<select id="getWorkDataListCnt" resultType="int" parameterType="int">
		SELECT
			COUNT(*)
		FROM
			work_data wd
		JOIN 
			user u ON wd.reg_user_idx = u.idx
		WHERE
			wd.work_idx = #{work_idx};
	</select>
	
</mapper>